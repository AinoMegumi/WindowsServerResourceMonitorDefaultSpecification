# Windows Server Resource Monitor仕様書
このリポジトリは、[Windows Server Resource Monitor](https://github.com/AinoMegumi/WindowsServerResourceMonitor)の仕様を記述しています。

## 取得できるもの
本サービスでは以下の情報が取得できます

- CPUの名称・使用率
- メモリ使用量(物理メモリ・仮想メモリ)
- ディスクの使用状況(ドライブ別)
- ネットワークの使用状況(ネットワーク別)
- Windowsサービスの状態

ただし、CPU使用率とメモリ使用量以外は全てユーザーがモニタリング対象として指定したもののみがモニタリング対象となります。

## 設定方法
本サービスは、server.xmlで全て制御されます。このserver.xmlの構造を変更すると、Windowsサービスが動作する際に異常な動作をすることがあるので構造を変更しないようにして下さい。

## 使い方
出来上がる実行ファイルは、サービスとしてもコンソールアプリケーションとしても動作します。

## Windowsサービスとして使用する
Windows Service Control Manager(以下、SCM)に登録し、サービスを開始することでサーバーのモニタリングが開始されます。

## コンソールアプリケーションとして使用する
以下のコマンドラインに対応しております。ただし、管理者権限が必要になりますのでご注意下さい。

- install
- uninstall
- start
- pause
- continue
- stop
- show

### install
SCMにモニタリングサービスの登録を行います

### uninstall
SCMからモニタリングサービスを削除します

### start
モニタリングサービスを開始します

### pause
モニタリングサービスを一時停止します。プロセスは残りますが、再開するまでモニタリングも停止します

### continue
一時停止されたモニタリングサービスを再開させます

### stop
モニタリングサービスを停止します。プロセスも消えます

### show
モニタリングサービスの状態を取得します

## サーバーアプリケーションにコマンドライン引数を渡す方法以外でインストールする場合の注意点
本サービスは、Windowsサービスのモニタリング機能が付いているため、動作させるにあたり高い特権レベルが必要になります。サーバーアプリケーションにコマンドライン引数を渡す方法でのインストールの場合、必要な特権レベルに合わせてインストールされますが、その他の方法を使ってインストールする場合は次のようにインストールして下さい

### コマンドプロンプトからsc.exeを使用

```shell
Microsoft Windows [Version 10.0.18363.720]
(c) 2019 Microsoft Corporation. All rights reserved.

C:\WINDOWS\system32> sc create (サービス名) start= delayed-auto binPath= "(実行ファイルのパス)" DisplayName= "(Windowsサービスの表示名(お好きな表示にして下さい))"

C:\WINDOWS\system32> sc description (サービス名) (説明(ご自身が分かりやすい説明文をつけてあげて下さい))

```

PowerShellでもNew-Serviceコマンドでできますけど、自動（遅延開始）にするのは無理みたいで、どうしてもscコマンドを叩かないといけなさげだったので(もしかすると私の調べ不足かもしれないけど…)sc.exeを使う方法のほうが楽だと思います

自動（遅延開始）を推奨している理由は、ちょっとだけ起動時の負荷が高いので、スムーズにWindowsがブートできるようにという意味合いがあります。スペックにバリバリ余裕がある人は自動でもいいですけど…

ちなみにですが、Windowsサービスのインストールにはsc.exeでもNew-Serviceでも管理者権限が必要になります。
